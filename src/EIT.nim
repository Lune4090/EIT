## Outerloop of FEM -> EIT calculation flow

import std/[rdstdin, stats]
import arraymancer, results
import setting, plotter, backward

echo "Welcome to nimEIT! please choose the mode..."
echo "1: forward-mode"
echo "2: backward-mode"
echo "0: exit"

var mode: int
while true:
  let mode_num = readLineFromStdin("mode: ")
  if mode_num != "0" and mode_num != "1" and mode_num != "2":
    echo "input is invalid, please try again"
  if mode_num == "1":
    mode = 1
    break
  if mode_num == "2":
    mode = 2
    break
  if mode_num == "0":
    mode = 0
    echo "good bye!"
    break

if mode == 1:
  # Define simulation parameters

  let system = Parameters(
    numElectrodes: 10*12,
    diameter: 10.0,
    numsInnerVertices: @[9*12, 8*12, 7*12, 6*12, 5*12, 4*12, 3*12, 2*12, 1*12, 6],
    diameters: @[9.0, 8.0, 7.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0, 0.5],
  )

  # Initial setting
  var
    mesh2d = initial_setting(system)

  # modify σRef
  for element in mesh2d.elements.mitems():
    var
      p1 = mesh2d.vertices[element.idxVertice1].pos
      p2 = mesh2d.vertices[element.idxVertice2].pos
      p3 = mesh2d.vertices[element.idxVertice3].pos
      p0 = ((p1[0]+p2[0]+p3[0])/3, (p1[1]+p2[1]+p3[1])/3)
    if (p0[0] - 0.0)^2 + (p0[1] - 5.0)^2 <= 2.0^2:
      element.σRef = 0.8
  

  # modify I
  for (i, vert) in mesh2d.vertices.mpairs():
    if i == 0:
      vert.I = 1.0
    elif i == 60:
      vert.I = -1.0
    else:
      vert.I = 0.0

  # Get stiffness matrices
  var
    (stackedLocalStiffnessMat, unitStackedLocalStiffnessMat, stiffness_mat) = get_stiffness_matrices(mesh2d)

  discard stackedLocalStiffnessMat
  discard unitStackedLocalStiffnessMat

  # Forward. Solve KV=I based on Galerkin method and update V, then get the voltage mapping
  var σRef: seq[float]
  for (i, elem) in mesh2d.elements.pairs():
    σRef.add(elem.σRef)
  
  var I: seq[float]
  for (i, vert) in mesh2d.vertices.pairs():
    I.add(vert.I)
  
  let V = solve(stiffness_mat, I.toTensor)
  for (i, vert) in mesh2d.vertices.mpairs():
    vert.V = V[i]

  # TODO: 順方向計算で得たデータを外部ファイルに書き出すように変更
  echo "I: " & $I
  echo "V: " & $V.toSeq1D
  echo "σRef: " & $σRef

  draw_V(mesh2d)


if mode == 2:
  # Define simulation parameters

  let system = Parameters(
    numElectrodes: 10*12,
    diameter: 10.0,
    numsInnerVertices: @[9*12, 8*12, 7*12, 6*12, 5*12, 4*12, 3*12, 2*12, 1*12, 6],
    diameters: @[9.0, 8.0, 7.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0, 0.5],
  )

  # Initial setting
  var
    mesh2d = initial_setting(system)
  
  # modify parameters
  # TODO: 順方向計算で得たデータは外部ファイルから読み込むように変更
  var
    I = @[1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
    V0 = @[1.553695809781414, 1.185056617913251, 0.9671450779411116, 0.8263417465352921, 0.7269398272707754, 0.6512888923291882, 0.59032063613897, 0.5391075626892412, 0.4947867916178217, 0.4555749220336979, 0.4202838098459966, 0.3881274467857057, 0.3585352308296006, 0.3310418743121413, 0.3052943474832484, 0.2810161651273172, 0.2579849436626531, 0.2360175774877516, 0.2149597639389186, 0.1946777998479179, 0.175050993309585, 0.1560163858850363, 0.1375166891792658, 0.1194616375868545, 0.1017755492946115, 0.08439210255211263, 0.06725112486488022, 0.05029633401512619, 0.03347335619219864, 0.01672742839029127, 0.0, -0.01672742839029758, -0.03347335619220869, -0.05029633401513874, -0.06725112486489442, -0.08439210255212817, -0.101775549294628, -0.1194616375868719, -0.1375166891792839, -0.156016385885055, -0.1750509933096043, -0.1946777998479379, -0.2149597639389391, -0.2360175774877725, -0.2579849436626742, -0.2810161651273388, -0.3052943474832705, -0.331041874312164, -0.3585352308296237, -0.3881274467857291, -0.4202838098460205, -0.4555749220337223, -0.4947867916178468, -0.5391075626892663, -0.5903206361389958, -0.6512888923292141, -0.7269398272708021, -0.826341746535319, -0.967145077941139, -1.185056617913277, -1.553695809781442, -1.18505661791328, -0.9671450779411395, -0.8263417465353202, -0.7269398272708032, -0.6512888923292159, -0.5903206361389969, -0.5391075626892677, -0.4947867916178487, -0.4555749220337247, -0.4202838098460226, -0.3881274467857317, -0.3585352308296266, -0.3310418743121669, -0.3052943474832734, -0.281016165127342, -0.2579849436626777, -0.2360175774877757, -0.2149597639389426, -0.1946777998479414, -0.1750509933096084, -0.1560163858850593, -0.1375166891792884, -0.1194616375868769, -0.1017755492946333, -0.08439210255213386, -0.06725112486490099, -0.05029633401514589, -0.03347335619221733, -0.01672742839030767, -1.345251965027228e-14, 0.01672742839028077, 0.03347335619219045, 0.05029633401511899, 0.06725112486487408, 0.0843921025521069, 0.1017755492946063, 0.1194616375868499, 0.1375166891792613, 0.1560163858850321, 0.1750509933095812, 0.1946777998479142, 0.2149597639389153, 0.2360175774877482, 0.2579849436626502, 0.2810161651273143, 0.3052943474832454, 0.3310418743121392, 0.3585352308295986, 0.388127446785704, 0.4202838098459946, 0.4555749220336964, 0.4947867916178206, 0.5391075626892398, 0.590320636138969, 0.6512888923291875, 0.726939827270774, 0.8263417465352914, 0.9671450779411097, 1.185056617913254, -1.228693033153831e-14, 0.9401030205708903, 0.8868738597952863, 0.8063515158461533, 0.7268009053857287, 0.6558912965575401, 0.5943069306858317, 0.5407807122663977, 0.4937807339554156, 0.4519832000761326, 0.4143469314748957, 0.3800484241304603, 0.348471314498999, 0.3191522163305616, 0.2917178171192391, 0.2658660565080719, 0.2413499453095959, 0.2179649137687142, 0.1955395200983858, 0.1739294317532651, 0.1530184874770896, 0.132705842056669, 0.1128941993111837, 0.09349440973131544, 0.07442480186479386, 0.0556097645079196, 0.03697830559635643, 0.01846301192923214, -5.252005792445761e-15, -0.01846301192924357, -0.03697830559636931, -0.05560976450793377, -0.07442480186480925, -0.09349440973133182, -0.112894199311201, -0.132705842056687, -0.1530184874771083, -0.1739294317532845, -0.1955395200984059, -0.2179649137687347, -0.241349945309617, -0.2658660565080934, -0.2917178171192611, -0.319152216330584, -0.3484713144990222, -0.3800484241304836, -0.4143469314749196, -0.4519832000761569, -0.4937807339554405, -0.5407807122664235, -0.5943069306858583, -0.6558912965575666, -0.7268009053857553, -0.8063515158461807, -0.8868738597953146, -0.9401030205709188, -0.8868738597953149, -0.8063515158461818, -0.726800905385756, -0.6558912965575671, -0.5943069306858594, -0.5407807122664249, -0.4937807339554426, -0.451983200076159, -0.4143469314749218, -0.3800484241304866, -0.3484713144990249, -0.3191522163305869, -0.2917178171192641, -0.2658660565080965, -0.2413499453096203, -0.2179649137687381, -0.1955395200984093, -0.1739294317532885, -0.1530184874771126, -0.1327058420566915, -0.1128941993112061, -0.09349440973133734, -0.07442480186481507, -0.05560976450794012, -0.03697830559637619, -0.01846301192925141, -1.345177334043632e-14, 0.0184630119292245, 0.03697830559634928, 0.0556097645079132, 0.07442480186478814, 0.09349440973131039, 0.1128941993111791, 0.1327058420566645, 0.1530184874770855, 0.1739294317532614, 0.1955395200983821, 0.2179649137687108, 0.2413499453095929, 0.2658660565080687, 0.2917178171192367, 0.3191522163305592, 0.3484713144989969, 0.3800484241304584, 0.4143469314748937, 0.451983200076131, 0.4937807339554146, 0.5407807122663965, 0.5943069306858307, 0.6558912965575392, 0.7268009053857279, 0.8063515158461535, 0.8868738597952862, 0.7009129911724697, 0.6857176269329253, 0.6505128684689427, 0.6062107348590385, 0.5596427867758704, 0.5142590972154325, 0.4714833281086744, 0.431701461848011, 0.3948294715748611, 0.3605662177811048, 0.3285852903889513, 0.2985964961156822, 0.2703270977472643, 0.243532374320263, 0.2179973325320101, 0.193534615734107, 0.169981143273505, 0.1471961241536065, 0.1250568048981067, 0.103450250843342, 0.08227244396109898, 0.06142682719873439, 0.04082286717554901, 0.02037471394706103, -7.283086540338088e-15, -0.02037471394707592, -0.0408228671755644, -0.06142682719875059, -0.08227244396111606, -0.1034502508433596, -0.125056804898125, -0.1471961241536256, -0.1699811432735246, -0.1935346157341273, -0.2179973325320311, -0.2435323743202844, -0.2703270977472861, -0.2985964961157047, -0.3285852903889744, -0.3605662177811285, -0.3948294715748855, -0.431701461848036, -0.4714833281086996, -0.514259097215458, -0.5596427867758964, -0.6062107348590652, -0.6505128684689699, -0.6857176269329525, -0.7009129911724974, -0.6857176269329534, -0.6505128684689708, -0.6062107348590663, -0.559642786775898, -0.5142590972154591, -0.4714833281087009, -0.4317014618480376, -0.3948294715748872, -0.3605662177811307, -0.328585290388977, -0.2985964961157074, -0.2703270977472891, -0.2435323743202875, -0.2179973325320344, -0.1935346157341308, -0.1699811432735285, -0.1471961241536297, -0.1250568048981296, -0.1034502508433645, -0.08227244396112103, -0.06142682719875613, -0.04082286717557018, -0.02037471394708177, -1.343898465470593e-14, 0.02037471394705489, 0.04082286717554329, 0.06142682719872918, 0.08227244396109402, 0.1034502508433375, 0.1250568048981026, 0.1471961241536026, 0.1699811432735014, 0.1935346157341036, 0.2179973325320072, 0.2435323743202604, 0.2703270977472617, 0.29859649611568, 0.3285852903889493, 0.3605662177811031, 0.3948294715748596, 0.4317014618480098, 0.4714833281086727, 0.5142590972154312, 0.5596427867758699, 0.606210734859038, 0.6505128684689425, 0.685717626932925, 0.5529556088808705, 0.5455227377021749, 0.5256145470358344, 0.4974442384586359, 0.4648313650816349, 0.4304902375413596, 0.3960842795531082, 0.3625150191509807, 0.330173381215286, 0.299185097696827, 0.2695530321866511, 0.2411967970478457, 0.2139963702825649, 0.1878167357660733, 0.1625208128830486, 0.1379755728542856, 0.1140589158340319, 0.09065476599158036, 0.06765178531008058, 0.04494319216602421, 0.02242601640898537, -8.528527847856549e-15, -0.02242601640900254, -0.04494319216604181, -0.06765178531009866, -0.09065476599159898, -0.1140589158340511, -0.1379755728543054, -0.1625208128830689, -0.1878167357660945, -0.2139963702825865, -0.2411967970478681, -0.2695530321866736, -0.2991850976968505, -0.33017338121531, -0.3625150191510055, -0.3960842795531334, -0.430490237541385, -0.4648313650816607, -0.4974442384586623, -0.5256145470358612, -0.5455227377022016, -0.5529556088808978, -0.5455227377022023, -0.5256145470358619, -0.4974442384586631, -0.4648313650816616, -0.4304902375413864, -0.3960842795531349, -0.3625150191510069, -0.3301733812153118, -0.2991850976968526, -0.2695530321866759, -0.2411967970478704, -0.2139963702825892, -0.1878167357660974, -0.1625208128830725, -0.1379755728543092, -0.1140589158340551, -0.09065476599160337, -0.0676517853101032, -0.04494319216604668, -0.02242601640900719, -1.341188772068284e-14, 0.02242601640898037, 0.04494319216601982, 0.06765178531007629, 0.09065476599157637, 0.114058915834028, 0.1379755728542821, 0.1625208128830455, 0.1878167357660704, 0.2139963702825622, 0.2411967970478434, 0.2695530321866488, 0.2991850976968253, 0.3301733812152846, 0.3625150191509791, 0.3960842795531069, 0.4304902375413587, 0.4648313650816337, 0.4974442384586352, 0.5256145470358339, 0.5455227377021747, 0.4418272200533757, 0.4369132296625159, 0.4231041965903034, 0.40246035570627, 0.377249906390354, 0.3493997568040785, 0.3203165676509615, 0.2909053031474974, 0.2617040780449351, 0.2330187874778503, 0.2049887036397889, 0.1776473314250573, 0.1509639367370842, 0.1248684346709996, 0.0992777156514905, 0.07409842244359878, 0.04922930123883469, 0.02456536765147754, -9.430291461912153e-15, -0.02456536765149647, -0.04922930123885388, -0.07409842244361842, -0.09927771565151058, -0.1248684346710202, -0.1509639367371053, -0.177647331425079, -0.2049887036398114, -0.2330187874778733, -0.2617040780449587, -0.2909053031475217, -0.3203165676509864, -0.3493997568041039, -0.3772499063903797, -0.402460355706296, -0.4231041965903298, -0.4369132296625429, -0.4418272200534029, -0.436913229662543, -0.4231041965903303, -0.402460355706297, -0.3772499063903808, -0.349399756804105, -0.3203165676509875, -0.2909053031475232, -0.2617040780449604, -0.2330187874778752, -0.2049887036398136, -0.1776473314250817, -0.1509639367371083, -0.1248684346710233, -0.09927771565151422, -0.07409842244362193, -0.04922930123885758, -0.02456536765150029, -1.334644679628764e-14, 0.0245653676514736, 0.04922930123883086, 0.07409842244359514, 0.09927771565148735, 0.1248684346709965, 0.1509639367370816, 0.1776473314250549, 0.2049887036397867, 0.2330187874778483, 0.2617040780449334, 0.290905303147496, 0.3203165676509602, 0.3493997568040777, 0.377249906390353, 0.4024603557062695, 0.4231041965903029, 0.4369132296625157, 0.3501107685485617, 0.3462022740858762, 0.335007155384919, 0.3178182579873527, 0.2962076555071892, 0.2716441406462247, 0.2452939717256011, 0.2179900712697221, 0.1902952061839754, 0.1625551559352592, 0.1349576707711632, 0.1075785680467305, 0.08043441991430478, 0.0534983429962335, 0.0267121309221886, -1.017946153843737e-14, -0.02671213092220901, -0.0534983429962541, -0.08043441991432572, -0.1075785680467519, -0.1349576707711851, -0.1625551559352815, -0.1902952061839982, -0.2179900712697457, -0.2452939717256252, -0.2716441406462495, -0.2962076555072147, -0.3178182579873784, -0.3350071553849451, -0.3462022740859027, -0.3501107685485884, -0.3462022740859028, -0.3350071553849455, -0.3178182579873789, -0.2962076555072155, -0.2716441406462503, -0.2452939717256264, -0.2179900712697473, -0.1902952061840003, -0.1625551559352837, -0.1349576707711877, -0.1075785680467544, -0.08043441991432852, -0.05349834299625716, -0.02671213092221221, -1.322357865669614e-14, 0.02671213092218576, 0.05349834299623069, 0.08043441991430204, 0.107578568046728, 0.1349576707711611, 0.1625551559352572, 0.1902952061839739, 0.2179900712697206, 0.2452939717256, 0.2716441406462237, 0.2962076555071887, 0.3178182579873522, 0.3350071553849184, 0.3462022740858759, 0.2700118319834062, 0.2664159143560803, 0.2560309361876741, 0.2398884013611197, 0.219300292099609, 0.1955407307068572, 0.169662884539366, 0.1424616317187224, 0.1144859395610902, 0.08608047729382398, 0.05746158633949534, 0.02874935722090327, -1.078632198805048e-14, -0.02874935722092485, -0.05746158633951718, -0.08608047729384606, -0.1144859395611126, -0.1424616317187451, -0.169662884539389, -0.1955407307068809, -0.2193002920996334, -0.2398884013611446, -0.2560309361876993, -0.2664159143561057, -0.2700118319834319, -0.2664159143561061, -0.2560309361877, -0.2398884013611453, -0.2193002920996343, -0.1955407307068822, -0.1696628845393907, -0.142461631718747, -0.1144859395611147, -0.08608047729384825, -0.05746158633951927, -0.02874935722092714, -1.308131160651788e-14, 0.02874935722090098, 0.05746158633949315, 0.08608047729382214, 0.1144859395610885, 0.1424616317187208, 0.1696628845393645, 0.195540730706856, 0.2193002920996082, 0.239888401361119, 0.2560309361876737, 0.2664159143560801, 0.197270297508946, 0.1934445422674627, 0.1823796461982108, 0.1651549547283164, 0.1431480523578982, 0.1176944851136092, 0.08991223539836093, 0.06064274904610163, 0.03051659690749389, -1.125250422207296e-14, -0.03051659690751648, -0.06064274904612443, -0.08991223539838399, -0.1176944851136326, -0.143148052357922, -0.1651549547283406, -0.1823796461982353, -0.1934445422674876, -0.1972702975089713, -0.193444542267488, -0.182379646198236, -0.1651549547283415, -0.1431480523579232, -0.1176944851136338, -0.08991223539838548, -0.06064274904612604, -0.03051659690751807, -1.291147411408126e-14, 0.03051659690749227, 0.06064274904610026, 0.08991223539835974, 0.1176944851136082, 0.1431480523578974, 0.1651549547283157, 0.1823796461982102, 0.1934445422674624, 0.1292151423467241, 0.1243138462150372, 0.1102707167714786, 0.08878388930779182, 0.0619489541555447, 0.03176574233574262, -1.166491841480036e-14, -0.03176574233576605, -0.06194895415556828, -0.08878388930781575, -0.1102707167715029, -0.1243138462150618, -0.1292151423467489, -0.1243138462150621, -0.1102707167715034, -0.08878388930781657, -0.06194895415556932, -0.03176574233576706, -1.273992178815945e-14, 0.0317657423357416, 0.06194895415554389, 0.08878388930779123, 0.1102707167714782, 0.124313846215037, 0.06398799956095533, 0.05515610186596798, 0.03155808788081547, -1.200090270556747e-14, -0.03155808788083957, -0.05515610186599234, -0.06398799956097996, -0.0551561018659926, -0.03155808788084007, -1.253269260269161e-14, 0.03155808788081507, 0.05515610186596772, 0.03189289096604217, 0.01587735621537253, -0.01587735621539686, -0.03189289096606675, -0.01587735621539711, 0.0158773562153723]
    V1 = @[1.557706448191279, 1.189232128340256, 0.9714872794154124, 0.830852279627642, 0.7316200179279023, 0.656139615360824, 0.5953421629539311, 0.5442993821519934, 0.5001473942431236, 0.4611015374467772, 0.4259720862663427, 0.3939704160262107, 0.3645227810492104, 0.3371607389222533, 0.3115273894209793, 0.2873415777009693, 0.264375347244755, 0.2424389974542565, 0.2213704776955507, 0.2010270391896824, 0.1812774801744474, 0.1620466630463468, 0.1432655575134442, 0.1248333021880535, 0.1066655575657825, 0.08869098883258068, 0.07085033576317035, 0.05309601547325684, 0.03539051881746055, 0.01770245859926593, 0.0, -0.01770245859926935, -0.03539051881746601, -0.05309601547326372, -0.07085033576317809, -0.08869098883258918, -0.1066655575657914, -0.124833302188063, -0.143265557513454, -0.1620466630463571, -0.1812774801744579, -0.2010270391896934, -0.221370477695562, -0.2424389974542681, -0.2643753472447667, -0.2873415777009812, -0.3115273894209916, -0.337160738922266, -0.3645227810492235, -0.3939704160262239, -0.4259720862663565, -0.4611015374467913, -0.5001473942431384, -0.5442993821520079, -0.5953421629539463, -0.6561396153608395, -0.7316200179279188, -0.8308522796276586, -0.9714872794154293, -1.189232128340272, -1.557706448191297, -1.188904735074459, -0.9708334411024016, -0.8298730520691071, -0.7303167114186001, -0.6545139259984776, -0.593396313229802, -0.5420362853697467, -0.4975708521375367, -0.4582164770778514, -0.4227848382235387, -0.3904900964669477, -0.3607617823765613, -0.3331343866457682, -0.3072547006836406, -0.2828460817927128, -0.2596859989489327, -0.2375912020521238, -0.2164072402425311, -0.1960002487838939, -0.1762493431826698, -0.1570916851687841, -0.1384700929334544, -0.1202940983461591, -0.1024878554714968, -0.08498489749505221, -0.067724915397334, -0.05065149207309732, -0.03371011374635717, -0.01684586250419144, -7.772204990303936e-15, 0.0168458625041759, 0.03371011374634164, 0.05065149207308178, 0.06772491539731844, 0.0849848974950366, 0.1024878554714811, 0.1202940983461434, 0.1384700929334388, 0.1570916851687683, 0.176249343182654, 0.1960002487838781, 0.2164072402425152, 0.2375912020521078, 0.2596859989489167, 0.2828460817926965, 0.307254700683624, 0.3331343866457521, 0.3607617823765448, 0.3904900964669314, 0.4227848382235221, 0.4582164770778344, 0.4975708521375198, 0.5420362853697297, 0.5933963132297853, 0.6545139259984601, 0.7303167114185817, 0.8298730520690887, 0.9708334411023819, 1.188904735074443, -7.115963482685011e-15, 0.9441092068776109, 0.8910635330218314, 0.8107273239931433, 0.7313651503722167, 0.6606458089946002, 0.5992528960777099, 0.5459184466635872, 0.4991093988112473, 0.4575004392083191, 0.4200484048936766, 0.3859268072144412, 0.3545154117530837, 0.3253464699974588, 0.2980412705225911, 0.2722911033965544, 0.2478408516746871, 0.2244760991399531, 0.2020135978112236, 0.1802950387206853, 0.1591866670272447, 0.1385684142996728, 0.1183249832173053, 0.09835101338835889, 0.07855322834597467, 0.05885823340434261, 0.03921805218402918, 0.01960575025339233, -2.852082615765247e-15, -0.01960575025339854, -0.03921805218403621, -0.05885823340435032, -0.07855322834598305, -0.09835101338836773, -0.1183249832173146, -0.1385684142996826, -0.1591866670272548, -0.1802950387206959, -0.2020135978112347, -0.2244760991399644, -0.2478408516746989, -0.2722911033965664, -0.2980412705226033, -0.3253464699974712, -0.3545154117530967, -0.3859268072144545, -0.4200484048936902, -0.4575004392083329, -0.4991093988112618, -0.5459184466636027, -0.5992528960777259, -0.6606458089946163, -0.731365150372233, -0.8107273239931605, -0.8910635330218493, -0.9441092068776284, -0.8906996042884666, -0.8100001246202795, -0.7302757012491844, -0.6591955554262342, -0.5974438423198881, -0.5437533540019733, -0.4965920529057835, -0.4546360036932941, -0.4168438918272275, -0.3823921889890122, -0.3506644825897189, -0.3211972105314401, -0.2936168717074323, -0.2676212159785134, -0.2429630669708265, -0.219437671840076, -0.1968734125713201, -0.1751257959299785, -0.154078607436662, -0.1336309427627659, -0.1136853414560372, -0.09415248022668299, -0.07495051319364646, -0.05600365644800229, -0.03724074760098565, -0.0185942076599637, -7.773421910462909e-15, 0.01859420765994815, 0.0372407476009701, 0.05600365644798672, 0.07495051319363084, 0.09415248022666738, 0.1136853414560216, 0.1336309427627503, 0.1540786074366463, 0.1751257959299628, 0.1968734125713043, 0.2194376718400602, 0.2429630669708106, 0.2676212159784971, 0.2936168717074165, 0.3211972105314241, 0.3506644825897026, 0.3823921889889956, 0.4168438918272108, 0.4546360036932775, 0.4965920529057667, 0.5437533540019559, 0.5974438423198705, 0.6591955554262171, 0.7302757012491671, 0.8100001246202616, 0.8906996042884483, 0.7049024772365693, 0.6899152478879642, 0.654922859986157, 0.6108370769801011, 0.5644890449349919, 0.5193282121408116, 0.4767773423435115, 0.4372211684591183, 0.4005739689782702, 0.3665316454579983, 0.3347635069849223, 0.3049743909793697, 0.2768849900932032, 0.2502419522071613, 0.2248190035407517, 0.2004140932755514, 0.1768450066879876, 0.1539420806462911, 0.1315440251431235, 0.1094945740133384, 0.08763973990041159, 0.0657856331842093, 0.04384903043585516, 0.02191859456598669, -3.957450020735759e-15, -0.02191859456599481, -0.04384903043586347, -0.0657856331842181, -0.08763973990042093, -0.109494574013348, -0.1315440251431336, -0.1539420806463015, -0.1768450066879984, -0.2004140932755624, -0.2248190035407633, -0.2502419522071733, -0.2768849900932155, -0.3049743909793822, -0.3347635069849352, -0.3665316454580117, -0.4005739689782843, -0.437221168459133, -0.4767773423435265, -0.5193282121408269, -0.5644890449350076, -0.6108370769801174, -0.6549228599861737, -0.689915247887981, -0.7049024772365865, -0.6895035219347108, -0.6540998459205802, -0.6096033400715478, -0.5628453957654448, -0.5172758882159993, -0.4743182637786582, -0.4343582803415483, -0.3973116850117718, -0.3628772273715763, -0.3307283554783633, -0.3005746104411237, -0.2721429903345463, -0.2451885135502897, -0.2194959328755717, -0.1948776467910725, -0.171170340967387, -0.1482331020818922, -0.1259430474746954, -0.1041870088765128, -0.08286073436979111, -0.06186743457834116, -0.04111634699359598, -0.02052139729590848, -7.756663418114836e-15, 0.02052139729589298, 0.04111634699358045, 0.06186743457832557, 0.08286073436977549, 0.1041870088764971, 0.1259430474746797, 0.1482331020818764, 0.1711703409673711, 0.1948776467910567, 0.219495932875556, 0.245188513550274, 0.2721429903345302, 0.3005746104411076, 0.3307283554783471, 0.3628772273715603, 0.3973116850117559, 0.4343582803415322, 0.4743182637786413, 0.5172758882159822, 0.5628453957654275, 0.6096033400715304, 0.6540998459205627, 0.6895035219346929, 0.5569085811492165, 0.5497165965194335, 0.5300568903463692, 0.5021429932603718, 0.4697947392316549, 0.435726664368544, 0.4016023640649511, 0.3683235101672699, 0.3362800878136207, 0.3055954605186986, 0.2762697253762842, 0.2482179178302308, 0.221312660974207, 0.1954073082896986, 0.1703465441419899, 0.1459586506691095, 0.1220490084452482, 0.09839323451302555, 0.07503907232410777, 0.04971019159164995, 0.02477004877403147, -4.599815634843163e-15, -0.02477004877404074, -0.04971019159165951, -0.07503907232411759, -0.09839323451303573, -0.1220490084452588, -0.1459586506691203, -0.170346544142001, -0.1954073082897101, -0.2213126609742189, -0.2482179178302432, -0.2762697253762966, -0.3055954605187117, -0.3362800878136343, -0.3683235101672842, -0.4016023640649655, -0.4357266643685587, -0.4697947392316703, -0.5021429932603876, -0.5300568903463855, -0.5497165965194495, -0.5569085811492329, -0.5492423015863945, -0.5291078900254927, -0.5007180073178187, -0.4678917057729042, -0.4333428233353311, -0.3987343333983988, -0.3649673324312253, -0.3324324983933449, -0.3012552797813134, -0.2714381001788079, -0.2429001573293094, -0.2155210351196944, -0.1891653406314184, -0.1636956306959503, -0.1389786795631374, -0.1148921804356137, -0.09131970318920557, -0.06814956618381703, -0.04527465167077457, -0.02259165850190684, -7.746740812693217e-15, 0.02259165850189136, 0.04527465167075907, 0.06814956618380147, 0.09131970318918996, 0.114892180435598, 0.1389786795631217, 0.1636956306959347, 0.1891653406314027, 0.2155210351196787, 0.2429001573292937, 0.271438100178792, 0.3012552797812975, 0.3324324983933293, 0.3649673324312093, 0.3987343333983828, 0.4333428233353149, 0.4678917057728874, 0.5007180073178014, 0.5291078900254754, 0.5492423015863775, 0.4457088962574349, 0.441078718576804, 0.427567700649261, 0.4072382618275024, 0.3823613920707667, 0.3548677096511317, 0.3261690256610869, 0.2971765900639915, 0.2684358205314779, 0.2402629022062408, 0.2128102667353928, 0.1861280436989019, 0.1602067375805267, 0.1349890345637049, 0.1103544074257093, 0.08400670129986332, 0.05548989062714159, 0.02760434833865848, -5.177524514226903e-15, -0.02760434833866887, -0.05548989062715214, -0.08400670129987413, -0.1103544074257204, -0.1349890345637163, -0.1602067375805384, -0.1861280436989138, -0.2128102667354052, -0.2402629022062534, -0.2684358205314911, -0.2971765900640053, -0.326169025661101, -0.3548677096511463, -0.3823613920707818, -0.4072382618275178, -0.4275677006492771, -0.4410787185768203, -0.4457088962574514, -0.4405238332929347, -0.4264550725337811, -0.4055614124559954, -0.3801098708556734, -0.3520263473026165, -0.3227166140419677, -0.2930850909236569, -0.2636693261263722, -0.2347744560087095, -0.2065390696049159, -0.1789960414079304, -0.1521140423417156, -0.1258226691513392, -0.1000384799855874, -0.07466755664096793, -0.04960811113698503, -0.02475463884619115, -7.702134582954507e-15, 0.02475463884617574, 0.0496081111369696, 0.07466755664095247, 0.1000384799855719, 0.1258226691513237, 0.1521140423417001, 0.1789960414079149, 0.2065390696049004, 0.2347744560086941, 0.2636693261263567, 0.2930850909236412, 0.322716614041952, 0.3520263473026009, 0.3801098708556573, 0.4055614124559792, 0.4264550725337646, 0.4405238332929182, 0.353857941332425, 0.3502862231045678, 0.3394534810897172, 0.3226592804823876, 0.3014852386870486, 0.2774141033048068, 0.2516340773634018, 0.2250121919869087, 0.1981643825958757, 0.1715246069197093, 0.1454299907349445, 0.1202558863487312, 0.09005100554311782, 0.06000751716814334, 0.02996812748389368, -5.667447843740732e-15, -0.02996812748390503, -0.06000751716815484, -0.09005100554312949, -0.120255886348743, -0.1454299907349565, -0.1715246069197216, -0.1981643825958882, -0.2250121919869219, -0.2516340773634152, -0.2774141033048207, -0.301485238687063, -0.3226592804824023, -0.3394534810897327, -0.3502862231045835, -0.3538579413324406, -0.349633601070164, -0.3381398761563074, -0.3206666016970129, -0.2987835262102722, -0.2739575657967239, -0.2473537895541884, -0.2198039934507786, -0.1918696216036371, -0.1638953065507339, -0.136067757117102, -0.1084622505419744, -0.08109480247561639, -0.0539375959881911, -0.02693154562652337, -7.644269049541811e-15, 0.02693154562650806, 0.05393759598817581, 0.08109480247560111, 0.1084622505419592, 0.1360677571170867, 0.1638953065507186, 0.191869621603622, 0.2198039934507633, 0.2473537895541731, 0.2739575657967085, 0.2987835262102566, 0.3206666016969972, 0.3381398761562915, 0.3496336010701483, 0.2735106639503656, 0.270305925162903, 0.260351563431527, 0.2446922811214039, 0.2246584668029611, 0.2015560099619793, 0.1764895284828239, 0.1503190995802445, 0.1236712169581279, 0.09699273993216137, 0.0644562378398561, 0.03216802759645179, -6.04674004546493e-15, -0.03216802759646387, -0.06445623783986835, -0.09699273993217369, -0.1236712169581403, -0.1503190995802572, -0.1764895284828367, -0.2015560099619924, -0.2246584668029748, -0.2446922811214181, -0.2603515634315415, -0.2703059251629178, -0.2735106639503808, -0.2695532752910206, -0.2588296826052078, -0.2423665982027293, -0.2214723342274386, -0.1974186249295888, -0.1712565576483414, -0.1437787958668286, -0.1155323963088466, -0.0868610865082014, -0.05798024919826945, -0.0290083384339393, -7.575703225961868e-15, 0.02900833843392416, 0.05798024919825431, 0.08686108650818632, 0.1155323963088316, 0.1437787958668136, 0.1712565576483265, 0.1974186249295738, 0.2214723342274236, 0.2423665982027141, 0.2588296826051926, 0.2695532752910055, 0.2003273792741821, 0.1969179857615994, 0.1863021316172185, 0.1695584406022609, 0.14806045035871, 0.1231190907253566, 0.09573989326934111, 0.06648444118903171, 0.03323212809616077, -6.406802263106542e-15, -0.03323212809617361, -0.06648444118904466, -0.09573989326935414, -0.1231190907253699, -0.1480604503587235, -0.1695584406022747, -0.1863021316172327, -0.196917985761614, -0.2003273792741969, -0.1961107644513154, -0.1846749819842896, -0.167095750480356, -0.1447474849472407, -0.118962922857696, -0.09085686057122003, -0.06126931388608975, -0.03082930556476154, -7.475242368349768e-15, 0.03082930556474661, 0.06126931388607484, 0.09085686057120515, 0.1189629228576813, 0.144747484947226, 0.1670957504803412, 0.1846749819842748, 0.1961107644513006, 0.1315429022857572, 0.1269858917646341, 0.113205962811002, 0.09179736505049292, 0.06465941412211118, 0.03345653643238897, -6.686983965081098e-15, -0.03345653643240241, -0.06465941412212471, -0.09179736505050674, -0.1132059628110161, -0.1269858917646485, -0.1315429022857717, -0.1262639031499596, -0.1118310729197596, -0.08995245759536298, -0.0627263353548464, -0.03215395749201808, -7.339778575374317e-15, 0.0321539574920034, 0.06272633535483173, 0.08995245759534835, 0.111831072919745, 0.126263903149945, 0.06525668887558723, 0.05650899325617047, 0.03252697644868833, -6.925875740947333e-15, -0.03252697644870223, -0.05650899325618459, -0.06525668887560153, -0.05609320937335422, -0.03204793043347694, -7.239953834958693e-15, 0.03204793043346248, 0.0560932093733398, 0.03254672460014055, 0.01628086867541851, -0.01628086867543259, -0.03254672460015481, -0.01615779780873145, 0.0161577978087171]
    σ0 = @[1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]
    σ1 = @[1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 1.0, 0.8, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 1.0, 0.8, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.8, 1.0, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.8, 1.0, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]

  for (i, elem) in mesh2d.elements.mpairs():
    elem.σRef = σ0[i]
    elem.Δσ = σ1[i]-σ0[i]
  for (i, vert) in mesh2d.vertices.mpairs():
    vert.I = I[i]
    vert.V = V0[i]
    vert.ΔV = V1[i]-V0[i]

  # Get stiffness matrices
  var
    (stackedLocalStiffnessMat, unitStackedLocalStiffnessMat, stiffness_mat) = get_stiffness_matrices(mesh2d)

  discard stackedLocalStiffnessMat

  # Backward-1. Calculate jacobian from global / local stiffness matrix and outer node's voltages
  let jac = mesh2d.compute_jac_2d_tri(stiffness_mat, unitStackedLocalStiffnessMat).value

  # Backward-2. Converge RMS based on differential re-construction method with regularization term
  let
    coef = jac.δσ_over_δV().value
    δσ = mesh2d.reconstruct_δσ(coef).value
  
  
  
  var
    errors: RunningStat

  for (i, elem) in mesh2d.elements.mpairs():
    elem.δσ = δσ[i]
    errors.push(abs(elem.δσ - elem.Δσ))
  
  echo errors

  # Backward-3. Get the reconstructed image !
  
  draw_Δσ(mesh2d)
  draw_δσ(mesh2d)

