# EITSpresense

## 使い方 How to use this library

Spresense + 拡張ボードの組み合わせを想定

## プログラマブルIC

### AD9833 (波形生成器)

参考資料
- https://www.analog.com/media/jp/technical-documentation/data-sheets/AD9833_JP.pdf

概要

- 通信手法
  - SPI通信

- 動作制御
  - 16bitのコントロール・レジスタを介して制御
  - AD5930と異なり、AD9833の周波数制御は純粋にコントロール・レジスタへの書き込みによって行われる

コントロール・レジスタ (16 bit, LSB: D0)
- 上位2bit:  内容変更を通知する対象の決定
  - (D15, D14):  D14と合わせて以下の内容を
    - (0, 0):  コントロール・レジスタの内容変更
    - (0, 1):  周波数レジスタ(FREQ0)の内容変更
    - (1, 0):  周波数レジスタ(FREQ1)の内容変更
    - (0, 1):  位相レジスタ(PHASE0, 1)の内容変更
- 下位14bit: 制御ビット
  - コントロール・レジスタの内容変更時
    - D13 (B28)
      - 周波数レジスタの書き込みモード変更
      - 1:  28bitの連続書き込み(2クロック分使用)
      - 0:  14 MSBs + 14 LSBsの個別書き込み
    - D12 (HLB)
      - D13で個別書き込みモードに指定した場合のみ使用、周波数レジスタの書き込み位置を指定
      - 1:  上位14bitに書き込み
      - 0:  下位14bitに書き込み
    - D11 (FSELECT)
      - 使用する周波数レジスタの選択
      - 1:  FREQ1
      - 0:  FREQ0
    - D10 (PSELECT)
       - 使用する位相レジスタの選択
      - 1:  PHASE1
      - 0:  PHASE0
    - D9  (reserved)
      - 0に設定すること
    - D8  (RESET)
      - 「内部レジスタ (位相/周波数/コントロール・レジスタ以外)」をリセット、8MCLKサイクル後に信号がDAC出力に反映される
      - 1:  内部レジスタを0にリセット
      - 0:  リセットしない
    - D7  (SLEEP1)
      - 省電力機能(内部MCLKクロック)
      - 1:  内部MCLKクロックを無効化、周波数/位相/制御ワードの書き込みを停止しDAC出力を現在値で固定
      - 0:  内部MCLKクロックを有効化、書き込みを受付
    - D6  (SLEEP12)
      - 省電力機能(内蔵DAC)
      - 1:  内蔵DACをOFF
      - 0:  内蔵DACをON
    - D5  (OPBITEN)
      - D1と組み合わせてVOUT出力を制御
      - 1:  VOUTの出力をMSB(クロック・ソース)に変更
      - 0:  VOUTの出力をDAC出力に変更
    - D4  (reserved)
      - 0に設定すること
    - D3  (DIV2)
      - D5と組み合わせて使用
      - 1:  MSBが出力
      - 0:  MSB/2が出力
    - D2  (reserved)
      - 0に設定すること
    - D1  (MODE)
      - D5と組み合わせて使用、D5=1の時は0に設定すること
      - 1:  三角波出力(SIN ROMをバイパス)
      - 0:  Sin波出力(SIN ROMを使用)
    - D0  (reserved)
      - 0に設定すること
